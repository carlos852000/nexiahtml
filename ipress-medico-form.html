<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NextIaDoctor • IPRESS • Registrar Médico</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' },
            accent: { 50: '#ecfeff', 100: '#cffafe', 200: '#a5f3fc', 300: '#67e8f9', 400: '#22d3ee', 500: '#06b6d4', 600: '#0891b2', 700: '#0e7490', 800: '#155e75', 900: '#164e63' }
          },
          boxShadow: { soft: '0 8px 24px rgba(2, 6, 23, 0.06)' }
        }
      }
    }
  </script>
  <style>
    * { scrollbar-width: thin; scrollbar-color: #cbd5e1 transparent }
    *::-webkit-scrollbar { height: 8px; width: 8px }
    *::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 8px }
    .scrollbar-hide::-webkit-scrollbar { display: none }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none }
  </style>
</head>

<body class="min-h-screen bg-slate-50 text-slate-800">
  <!-- Topbar con info IPRESS -->
  <header class="fixed inset-x-0 top-0 z-40 bg-gradient-to-r from-brand-600 to-accent-500 text-white shadow-soft">
    <div class="mx-auto flex h-16 max-w-screen-2xl items-center px-4">
      <div class="flex-1 flex items-center gap-4">
        <a href="dashboard.html" class="inline-flex items-center gap-3">
          <div class="select-none text-lg font-semibold tracking-wide">NextIaCorp</div>
        </a>
        <!-- Chip de IPRESS activa -->
        <div class="hidden md:flex items-center gap-2 rounded-lg bg-white/20 px-4 py-1.5 shadow-sm backdrop-blur-sm">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-white">
            <path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
          </svg>
          <span class="font-semibold text-white">Ipress San Martín</span>
          <!--<span class="hidden text-xs text-white/70 md:inline">•</span>
          <span class="hidden text-xs text-white/95 md:inline">RUC 20123456789</span>-->
        </div>
      </div>
      <nav class="flex items-center gap-2" aria-label="Navegación superior">
        <a href="reportes.html" class="hidden rounded-lg bg-white/10 px-3 py-1.5 text-sm font-medium backdrop-blur hover:bg-white/20 md:inline">Reportes</a>
        <a href="soporte.html" class="hidden rounded-lg bg-white/10 px-3 py-1.5 text-sm font-medium backdrop-blur hover:bg-white/20 md:inline">Soporte</a>
        <img src="https://api.dicebear.com/7.x/initials/svg?seed=ND" alt="avatar" class="h-8 w-8 rounded-full ring-2 ring-white/30" />
      </nav>
    </div>
  </header>

  <!-- Menú Nivel 1 • IPRESS seleccionada (Médicos activo) -->
  <nav class="fixed top-16 inset-x-0 z-30 bg-white border-b border-slate-200 shadow-soft">
    <div class="mx-auto max-w-screen-2xl px-4">
      <div class="flex items-center justify-between">
        <!-- Tabs/menú de la IPRESS -->
        <div class="flex items-center overflow-x-auto py-2 gap-2 scrollbar-hide">
          <a href="ipress-dashboard.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6"/></svg><span>Dashboard</span></a>

          <a href="ipress-sedes.html"  class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg><span>Sedes</span><span class="ml-1 rounded-full bg-brand-100 px-1.5 py-0.5 text-xs font-medium text-brand-800">5</span></a>

          <a href="ipress-usuarios.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg><span>Usuarios</span></a>

          <a href="ipress-medicos.html" aria-current="page" class="flex items-center gap-2 rounded-lg bg-brand-50 px-3 py-2 text-sm font-medium text-brand-700 border-b-2 border-brand-600 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M4 7a4 4 0 118 0 4 4 0 01-8 0zm12 4h4m-2-2v4m-6 4a6 6 0 10-12 0"/></svg><span>Médicos</span></a>

          <a href="ipress-servicios.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg><span>Servicios</span></a>
        </div>

        <!-- Acciones rápidas a la derecha -->
        <div class="flex items-center gap-2">
          <a href="ipress-agenda.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 002-2v-6H3v6a2 2 0 002 2z"/></svg><span>Agenda</span></a>
          <a href="ipress-reservas.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m6-6H6"/></svg><span>Reservas</span></a>
          <a href="ipress-atenciones.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg><span>Atenciones</span></a>
          <a href="ipress-reportes.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 14l9-5-9-5-9 5 9 5z"/><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 14l6.16-3.422A12.083 12.083 0 016 8.577M12 14v7"/></svg><span>Reportes</span></a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="pt-36 pb-24">
    <div class="mx-auto max-w-screen-2xl px-6">
      <!-- Encabezado y acciones -->
      <div class="mb-6 flex flex-wrap items-center justify-between gap-3">
        <div>
          <nav class="text-xs text-slate-500"><a class="hover:underline" href="ipress.html">IPRESS</a> / <a class="hover:underline" href="ipress-medicos.html">Médicos</a> / <span class="text-slate-700 font-medium">Registrar médico</span></nav>
          <h1 class="mt-1 text-2xl font-semibold tracking-tight text-slate-800">Registrar médico</h1>
          <p class="text-sm text-slate-500">Crea el registro de <span class="font-medium">persona</span> y <span class="font-medium">médico</span>, asigna especialidades y sedes.</p>
        </div>
        <div class="flex items-center gap-2">
          <a href="ipress-medicos.html" class="rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50">← Volver a Médicos</a>
        </div>
      </div>

      <form id="formMedico" class="grid gap-6 lg:grid-cols-3">
        <!-- Columna principal -->
        <section class="space-y-6 lg:col-span-2">
          <!-- Datos personales (tabla persona) -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold">Datos personales</h2>
              <div class="flex items-center gap-2 text-xs text-slate-500"><span>Fuente: tabla <code>persona</code></span></div>
            </div>
            <div class="grid gap-4 md:grid-cols-4">
              <div class="md:col-span-1">
                <label class="mb-1 block text-sm font-medium text-slate-700">Tipo documento</label>
                <select name="tipo_documento" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option value="DNI">DNI</option>
                  <option value="CE">CE</option>
                  <option value="PAS">Pasaporte</option>
                </select>
              </div>
              <div class="md:col-span-1">
                <label class="mb-1 block text-sm font-medium text-slate-700">N.º documento</label>
                <input name="numero_documento" required placeholder="Ej. 12345678" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div class="md:col-span-2">
                <label class="mb-1 block text-sm font-medium text-slate-700">Correo</label>
                <input name="email" type="email" placeholder="medico@ipress.com" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div class="md:col-span-2">
                <label class="mb-1 block text-sm font-medium text-slate-700">Nombres</label>
                <input name="nombre" required placeholder="Nombres" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Apellido paterno</label>
                <input name="apellido_paterno" required placeholder="Apellido paterno" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Apellido materno</label>
                <input name="apellido_materno" required placeholder="Apellido materno" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Teléfono</label>
                <input name="telefono" type="tel" placeholder="999 999 999" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Fecha nacimiento</label>
                <input name="fecha_nacimiento" type="date" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Sexo</label>
                <select name="sexo" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option value="M">Masculino</option>
                  <option value="F">Femenino</option>
                  <option value="NA">Prefiero no decir</option>
                </select>
              </div>
              <div class="md:col-span-2">
                <label class="mb-1 block text-sm font-medium text-slate-700">Dirección</label>
                <input name="direccion_persona" placeholder="Calle, número, distrito" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Grupo sanguíneo</label>
                <select name="grupo_sanguineo" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option value="">—</option>
                  <option>O+</option><option>O-</option>
                  <option>A+</option><option>A-</option>
                  <option>B+</option><option>B-</option>
                  <option>AB+</option><option>AB-</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Datos profesionales (tabla medico) -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold">Datos profesionales</h2>
              <div class="text-xs text-slate-500">Fuente: tablas <code>medico</code></div>
            </div>
            <div class="grid gap-4 md:grid-cols-4">
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">CMP</label>
                <input name="cmp" required placeholder="Ej. 123456" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div class="md:col-span-2">
                <label class="mb-1 block text-sm font-medium text-slate-700">Correo profesional</label>
                <input name="email_prof" type="email" placeholder="nombre.apellido@ipress.com" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Teléfono</label>
                <input name="telefono_prof" type="tel" placeholder="(01) 000-0000" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div class="md:col-span-4">
                <label class="mb-1 block text-sm font-medium text-slate-700">Dirección fiscal/consulta</label>
                <input name="direccion_medico" placeholder="Calle y número" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div class="md:col-span-2">
                <label class="mb-1 block text-sm font-medium text-slate-700">Número de cuenta</label>
                <input name="numero_cuenta" placeholder="CCI / Cuenta" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Estado</label>
                <select name="estado_auditoria" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20"><option value="ACTIVO">ACTIVO</option><option value="INACTIVO">INACTIVO</option></select>
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Foto (opcional)</label>
                <input type="file" accept="image/*" class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white" />
              </div>
            </div>
          </div>

          <!-- Especialidades (tabla medico_especialidad) -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold">Especialidades</h2>
              <div class="text-xs text-slate-500">Fuente: tabla <code>medico_especialidad</code> (incluye <code>rne</code>)</div>
            </div>
            <div id="especialidadesWrap" class="space-y-3">
              <!-- fila plantilla -->
            </div>
            <button type="button" id="addEsp" class="mt-3 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm hover:bg-slate-50">+ Agregar especialidad</button>
          </div>

          <!-- Asignación a Sedes/Consultorios (sede, consultorio) -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold">Asignación a sedes y consultorios</h2>
              <div class="text-xs text-slate-500">Relación con <code>sede</code> y <code>consultorio</code> para agendas</div>
            </div>
            <div id="sedesWrap" class="space-y-3"></div>
            <button type="button" id="addSede" class="mt-3 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm hover:bg-slate-50">+ Agregar sede</button>
            <p class="mt-2 text-xs text-slate-500">Tip: La asignación a consultorios facilita crear <code>agenda_medico</code> por sede.</p>
          </div>
        </section>

        <!-- Lateral -->
        <aside class="space-y-6">
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h3 class="mb-3 text-sm font-semibold text-slate-800">Acciones</h3>
            <div class="grid gap-2">
              <button type="submit" class="w-full rounded-lg bg-brand-600 px-4 py-2 text-sm font-semibold text-white hover:bg-brand-700">Guardar médico</button>
              <button type="button" id="btnLimpiar" class="w-full rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50">Limpiar</button>
              <a href="ipress-medicos.html" class="w-full rounded-lg border border-slate-200 bg-white px-4 py-2 text-center text-sm font-medium text-slate-700 hover:bg-slate-50">Cancelar</a>
            </div>
          </div>

          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h3 class="mb-2 text-sm font-semibold text-slate-800">Resumen</h3>
            <ul class="text-sm text-slate-600" id="resumen">
              <li><span class="text-slate-500">Nombre:</span> —</li>
              <li><span class="text-slate-500">CMP:</span> —</li>
              <li><span class="text-slate-500">Especialidades:</span> 0</li>
              <li><span class="text-slate-500">Sedes asignadas:</span> 0</li>
              <li><span class="text-slate-500">Estado:</span> ACTIVO</li>
            </ul>
          </div>

          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h3 class="mb-2 text-sm font-semibold text-slate-800">Buenas prácticas</h3>
            <ul class="list-disc pl-5 text-xs text-slate-600 space-y-1">
              <li>Valida CMP y RNE con tus integraciones (si aplica).</li>
              <li>Registra al menos una especialidad para habilitar agenda.</li>
              <li>Asigna sedes y consultorios antes de publicar horarios.</li>
            </ul>
          </div>
        </aside>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="fixed bottom-0 left-0 right-0 z-40 border-t border-slate-200 bg-white/90 backdrop-blur">
    <div class="mx-auto flex h-12 max-w-screen-2xl items-center justify-between px-6 text-sm text-slate-600">
      <p>© <span id="y"></span> NextIaCorp • Todos los derechos reservados</p>
      <nav class="hidden gap-4 md:flex">
        <a class="hover:text-slate-900" href="privacidad.html">Privacidad</a>
        <a class="hover:text-slate-900" href="terminos.html">Términos</a>
        <a class="hover:text-slate-900" href="contacto.html">Contacto</a>
      </nav>
    </div>
  </footer>

  <template id="tplEsp">
    <div class="grid gap-3 md:grid-cols-6 border border-slate-100 rounded-xl p-3">
      <div class="md:col-span-3">
        <label class="mb-1 block text-xs font-medium text-slate-600">Especialidad</label>
        <select name="especialidad[]" class="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-brand-600 focus:outline-none">
          <option value="">Seleccione…</option>
          <option value="1">Medicina Interna</option>
          <option value="2">Pediatría</option>
          <option value="3">Ginecología</option>
          <option value="4">Traumatología</option>
        </select>
      </div>
      <div class="md:col-span-2">
        <label class="mb-1 block text-xs font-medium text-slate-600">RNE (si aplica)</label>
        <input name="rne[]" placeholder="Registro Nacional de Especialista" class="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
      </div>
      <div class="md:col-span-1 flex items-end">
        <button type="button" class="removeEsp w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50">Quitar</button>
      </div>
    </div>
  </template>

  <template id="tplSede">
    <div class="grid gap-3 md:grid-cols-6 border border-slate-100 rounded-xl p-3">
      <div class="md:col-span-2">
        <label class="mb-1 block text-xs font-medium text-slate-600">Sede</label>
        <select name="sede[]" class="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-brand-600 focus:outline-none">
          <option value="">Seleccione…</option>
          <option value="SE-001">Miraflores</option>
          <option value="SE-002">San Isidro</option>
          <option value="SE-003">Surco</option>
        </select>
      </div>
      <div class="md:col-span-3">
        <label class="mb-1 block text-xs font-medium text-slate-600">Consultorios</label>
        <select name="consultorios[]" multiple class="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-brand-600 focus:outline-none">
          <option value="C-101">Piso 1 — 101</option>
          <option value="C-102">Piso 1 — 102</option>
          <option value="C-201">Piso 2 — 201</option>
          <option value="C-202">Piso 2 — 202</option>
        </select>
        <p class="mt-1 text-[11px] text-slate-500">Mantenga presionada la tecla Ctrl/Cmd para seleccionar varios.</p>
      </div>
      <div class="md:col-span-1 flex items-end">
        <button type="button" class="removeSede w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50">Quitar</button>
      </div>
    </div>
  </template>

  <script>
    // Año
    document.getElementById('y').textContent = new Date().getFullYear();

    const resumen = () => {
      const nombre = (document.querySelector('[name="nombre"]').value || '') + ' ' + (document.querySelector('[name="apellido_paterno"]').value || '');
      const cmp = document.querySelector('[name="cmp"]').value || '—';
      const espCount = document.querySelectorAll('#especialidadesWrap > .grid').length;
      const sedeCount = document.querySelectorAll('#sedesWrap > .grid').length;
      const estado = document.querySelector('[select[name="estado_auditoria"], select[name="estado_auditoria"]')?.value || 'ACTIVO';
      const ul = document.getElementById('resumen');
      ul.innerHTML = `<li><span class="text-slate-500">Nombre:</span> ${nombre.trim() || '—'}</li>
      <li><span class="text-slate-500">CMP:</span> ${cmp}</li>
      <li><span class="text-slate-500">Especialidades:</span> ${espCount}</li>
      <li><span class="text-slate-500">Sedes asignadas:</span> ${sedeCount}</li>
      <li><span class="text-slate-500">Estado:</span> ${document.querySelector('[name="estado_auditoria"]').value}</li>`;
    };

    // Inicializar una fila por defecto
    const espWrap = document.getElementById('especialidadesWrap');
    const tplEsp = document.getElementById('tplEsp');
    const addEsp = (evt) => {
      const node = tplEsp.content.cloneNode(true);
      espWrap.appendChild(node);
      bindEspEvents();
      resumen();
    };
    const bindEspEvents = () => {
      espWrap.querySelectorAll('.removeEsp').forEach(btn => btn.onclick = (e) => { e.currentTarget.closest('.grid').remove(); resumen(); });
      espWrap.querySelectorAll('select, input').forEach(el => el.oninput = resumen);
    };
    document.getElementById('addEsp').onclick = addEsp;
    addEsp(); // una por defecto

    const sedesWrap = document.getElementById('sedesWrap');
    const tplSede = document.getElementById('tplSede');
    const addSede = () => {
      const node = tplSede.content.cloneNode(true);
      sedesWrap.appendChild(node);
      bindSedeEvents();
      resumen();
    };
    const bindSedeEvents = () => {
      sedesWrap.querySelectorAll('.removeSede').forEach(btn => btn.onclick = (e) => { e.currentTarget.closest('.grid').remove(); resumen(); });
      sedesWrap.querySelectorAll('select').forEach(el => el.oninput = resumen);
    };
    document.getElementById('addSede').onclick = addSede;

    // Resumen dinámico
    document.querySelectorAll('[name="nombre"], [name="apellido_paterno"], [name="cmp"], [name="estado_auditoria"]').forEach(el => el.addEventListener('input', resumen));
    resumen();

    // Limpiar
    document.getElementById('btnLimpiar').onclick = () => {
      document.getElementById('formMedico').reset();
      espWrap.innerHTML = '';
      sedesWrap.innerHTML = '';
      addEsp();
      resumen();
    };

    // Validación + redirección
    document.getElementById('formMedico').addEventListener('submit', function(e){
      e.preventDefault();
      const numDoc = (this.numero_documento.value || '').trim();
      const cmp = (this.cmp.value || '').trim();
      const espCount = document.querySelectorAll('#especialidadesWrap select[name="especialidad[]"]').length;
      if (!numDoc) { alert('El número de documento es obligatorio.'); return; }
      if (!cmp) { alert('El CMP es obligatorio.'); return; }
      if (espCount === 0) { alert('Registra al menos una especialidad.'); return; }
      alert('Médico guardado correctamente (demo).');
      window.location.href = 'ipress-medicos.html';
    });
  </script>
</body>

</html>
