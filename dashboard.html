<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NextIaDoctor</title>
  <!-- Tailwind para prototipo. En Angular, instala Tailwind localmente. -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Paleta base inspirada en la landing. Ajusta si tienes HEX exactos.
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50:  '#eef2ff',
              100: '#e0e7ff',
              200: '#c7d2fe',
              300: '#a5b4fc',
              400: '#818cf8',
              500: '#6366f1', // Indigo
              600: '#4f46e5',
              700: '#4338ca',
              800: '#3730a3',
              900: '#312e81'
            },
            accent: {
              50:  '#ecfeff',
              100: '#cffafe',
              200: '#a5f3fc',
              300: '#67e8f9',
              400: '#22d3ee',
              500: '#06b6d4', // Cyan
              600: '#0891b2',
              700: '#0e7490',
              800: '#155e75',
              900: '#164e63'
            }
          },
          boxShadow: {
            soft: '0 8px 24px rgba(2, 6, 23, 0.06)'
          },
          borderRadius: {
            xl2: '1.25rem'
          }
        }
      }
    }
  </script>
  <!-- Chart.js para los gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <style>
    :root{ --radius: 16px; }
    /* Scrollbar sutil */
    *{ scrollbar-width: thin; scrollbar-color: #cbd5e1 transparent; }
    *::-webkit-scrollbar{ height:8px; width:8px; }
    *::-webkit-scrollbar-thumb{ background:#cbd5e1; border-radius:8px; }
    
    /* Control de gráficos para evitar extensión infinita */
    .chart-container {
      position: relative;
      height: 200px;
      width: 100%;
      overflow: hidden;
    }
    
    .chart-container canvas {
      max-height: 200px !important;
      max-width: 100% !important;
    }
    
    /* Mejoras de scroll y layout */
    .dashboard-content {
      overflow-x: hidden;
    }
    
    /* Optimización para dispositivos móviles */
    @media (max-width: 768px) {
      .chart-container {
        height: 180px;
      }
      .chart-container canvas {
        max-height: 180px !important;
      }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
  <!-- Topbar -->
  <header class="fixed inset-x-0 top-0 z-40 bg-gradient-to-r from-brand-600 to-accent-500 text-white shadow-soft">
    <!-- Barra superior principal -->
    <div class="mx-auto flex h-16 max-w-screen-2xl items-center px-4">
      <div class="flex-1 flex items-center gap-4">
        <a href="index.html" class="inline-flex items-center gap-3">
          <div class="select-none text-lg font-semibold tracking-wide">NextIaCorp</div>
        </a>
        <!-- Información de IPRESS alineada a la izquierda -->
        <!--<div class="flex items-center gap-2 rounded-lg bg-white/20 px-4 py-1.5 shadow-sm backdrop-blur-sm">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-white"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
          <span class="font-semibold text-white">Ipress San Martín</span>
          <span class="hidden text-xs text-white/70 md:inline">•</span>
          <span class="hidden text-xs text-white/95 md:inline">Sede Miraflores</span>
        </div>-->
      </div>
      
      <nav class="flex items-center gap-2" aria-label="Navegación superior">
        <a href="reportes.html" class="hidden rounded-lg bg-white/10 px-3 py-1.5 text-sm font-medium backdrop-blur hover:bg-white/20 md:inline">Reportes</a>
        <a href="soporte.html" class="hidden rounded-lg bg-white/10 px-3 py-1.5 text-sm font-medium backdrop-blur hover:bg-white/20 md:inline">Soporte</a>
        <img src="https://api.dicebear.com/7.x/initials/svg?seed=ND" alt="avatar" class="h-8 w-8 rounded-full ring-2 ring-white/30" />
      </nav>

    </div>
  </header>

  <!-- Navegación Horizontal -->
  <nav class="fixed top-16 inset-x-0 z-30 bg-white border-b border-slate-200 shadow-soft">
    <div class="mx-auto max-w-screen-2xl px-4">
      <div class="flex items-center justify-between">
        <!-- Menú Principal -->
        <div class="flex items-center overflow-x-auto py-2 gap-1">
          <a href="dashboard.html" class="flex items-center gap-2 rounded-lg bg-slate-100 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' class='h-5 w-5 text-brand-600'><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6'/></svg>Dashboard</a>
          <a href="ipress.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' class='h-5 w-5 text-brand-600'><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M3 7h18M3 12h18M3 17h18'/></svg>IPRESS</a>
          <a href="agenda-medico.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' class='h-5 w-5 text-brand-600'><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 002-2v-6H3v6a2 2 0 002 2z'/></svg>Agenda</a>
          <a href="reserva.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' class='h-5 w-5 text-brand-600'><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M12 6v12m6-6H6'/></svg>Reservas</a>
          <a href="atencion.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M22 12h-4l-3 7L9 5l-3 7H2"/></svg>Atenciones</a>
          <a href="reportes.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' class='h-5 w-5 text-brand-600'><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M12 14l9-5-9-5-9 5 9 5z'/><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M12 14l6.16-3.422A12.083 12.083 0 016 8.577M12 14v7'/></svg>Reportes</a>
        </div>
        
        <!-- Menú Administración con desplegable -->
        <div class="relative group">
          <button class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100">
            <span>Administración</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-4 w-4"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
          </button>
          <div class="absolute right-0 top-full z-40 hidden group-hover:block bg-white rounded-lg shadow-soft border border-slate-200 min-w-[180px] py-1">
            <a href="servicios.html" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' class='h-5 w-5 text-brand-600'><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M5.5 21h13a1.5 1.5 0 001.5-1.5V9.75a1.5 1.5 0 00-.44-1.06L14.31 2.44A1.5 1.5 0 0013.25 2H6.5A1.5 1.5 0 005 3.5V19.5A1.5 1.5 0 005.5 21z'/></svg>Servicios</a>
            <a href="medicos.html" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' class='h-5 w-5 text-brand-600'><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M4 7a4 4 0 118 0 4 4 0 01-8 0zm12 4h4m-2-2v4m-6 4a6 6 0 10-12 0'/></svg>Médicos</a>
            <a href="aseguradoras.html" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' class='h-5 w-5 text-brand-600'><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M12 6.253v13m0 0c-3.5 0-6.5-2-6.5-4.5S8.5 10.253 12 10.253s6.5 2 6.5 4.5-3 4.5-6.5 4.5z'/></svg>Aseguradoras/Planes</a>
            <a href="seguridad.html" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' class='h-5 w-5 text-brand-600'><path stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M12 12a5 5 0 100-10 5 5 0 000 10zm-7 9a7 7 0 0114 0v1H5v-1z'/></svg>Seguridad</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="pt-36 pb-24 dashboard-content">
    <div class="mx-auto max-w-screen-2xl px-6">
      <!-- Header -->
      <div class="mb-6 flex flex-wrap items-center justify-between gap-3">
        <div>
          <h1 class="text-2xl font-semibold tracking-tight text-slate-800">Dashboard</h1>
          <p class="text-sm text-slate-500">Resumen general del sistema</p>
          <!-- Indicador de estado del sistema -->
          <div class="mt-2 flex items-center gap-2">
            <div class="flex h-2 w-2 rounded-full bg-emerald-500"></div>
            <span class="text-xs text-emerald-600 font-medium">Sistema operativo</span>
            <span class="text-xs text-slate-400">• Última actualización: <span id="lastUpdate">Hace 2 min</span></span>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button class="rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white shadow-soft hover:bg-brand-700 transition-colors">Nueva reserva</button>
          <button class="rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-colors">Exportar</button>
        </div>
      </div>

      <!-- KPIs -->
      <section class="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
        <article class="rounded-2xl border border-slate-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs uppercase tracking-wider text-slate-400">Citas de hoy</p>
              <h3 class="mt-1 text-2xl font-semibold">128</h3>
            </div>
            <div class="rounded-xl bg-brand-600/10 p-3 text-brand-600">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-6 w-6"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 002-2v-6H3v6a2 2 0 002 2z"/></svg>
            </div>
          </div>
        </article>
        <article class="rounded-2xl border border-slate-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs uppercase tracking-wider text-slate-400">No-show</p>
              <h3 class="mt-1 text-2xl font-semibold">3.4%</h3>
            </div>
            <div class="rounded-xl bg-brand-600/10 p-3 text-brand-600">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-6 w-6"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m6-6H6"/></svg>
            </div>
          </div>
        </article>
        <article class="rounded-2xl border border-slate-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs uppercase tracking-wider text-slate-400">Médicos activos</p>
              <h3 class="mt-1 text-2xl font-semibold">54</h3>
            </div>
            <div class="rounded-xl bg-brand-600/10 p-3 text-brand-600">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-6 w-6"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M4 7a4 4 0 118 0 4 4 0 01-8 0zm12 4h4m-2-2v4m-6 4a6 6 0 10-12 0"/></svg>
            </div>
          </div>
        </article>
        <article class="rounded-2xl border border-slate-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs uppercase tracking-wider text-slate-400">Satisfacción</p>
              <h3 class="mt-1 text-2xl font-semibold">4.7/5</h3>
            </div>
            <div class="rounded-xl bg-brand-600/10 p-3 text-brand-600">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-6 w-6"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 17.75L5.5 21l1.25-7.25L2 8.75l7.25-1.05L12 1.75l2.75 5.95L22 8.75l-4.75 5.99L18.5 21 12 17.75z"/></svg>
            </div>
          </div>
        </article>
      </section>

      <!-- Paneles -->
      <section class="mt-6 grid gap-6 lg:grid-cols-3">
        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft lg:col-span-2">
          <div class="mb-4 flex items-center justify-between">
            <h2 class="text-lg font-semibold">Próximas reservas</h2>
            <a href="#" class="text-sm font-medium text-brand-700 hover:underline">Ver todo</a>
          </div>
          <ul class="divide-y divide-slate-100">
            <li class="flex items-center justify-between py-3">
              <div class="space-y-0.5">
                <p class="text-sm font-medium">María López</p>
                <p class="text-xs text-slate-500">Dr. Pérez • Cardiología • Hoy, 10:30</p>
              </div>
              <span class="rounded-full bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-700">Confirmada</span>
            </li>
            <li class="flex items-center justify-between py-3">
              <div class="space-y-0.5">
                <p class="text-sm font-medium">Juan Díaz</p>
                <p class="text-xs text-slate-500">Dra. Rivera • Dermato • Hoy, 11:00</p>
              </div>
              <span class="rounded-full bg-amber-50 px-3 py-1 text-xs font-medium text-amber-700">Pendiente</span>
            </li>
            <li class="flex items-center justify-between py-3">
              <div class="space-y-0.5">
                <p class="text-sm font-medium">Ana Torres</p>
                <p class="text-xs text-slate-500">Dr. Salas • Pediatría • 14:00</p>
              </div>
              <span class="rounded-full bg-sky-50 px-3 py-1 text-xs font-medium text-sky-700">Reprogramada</span>
            </li>
          </ul>
        </div>
        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
          <div class="mb-4 flex items-center justify-between">
            <h2 class="text-lg font-semibold">Indicadores</h2>
            <button class="text-sm font-medium text-slate-500 hover:text-slate-700">Actualizar</button>
          </div>
          <div class="space-y-4">
            <div>
              <div class="flex items-center justify-between text-sm">
                <span>Ocupación</span><span class="font-medium">82%</span>
              </div>
              <div class="mt-1 h-2 w-full overflow-hidden rounded-full bg-slate-100">
                <div class="h-full w-[82%] rounded-full bg-gradient-to-r from-brand-600 to-accent-500"></div>
              </div>
            </div>
            <div>
              <div class="flex items-center justify-between text-sm">
                <span>Tiempo prom. espera</span><span class="font-medium">12m</span>
              </div>
              <div class="mt-1 h-2 w-full overflow-hidden rounded-full bg-slate-100">
                <div class="h-full w-[60%] rounded-full bg-gradient-to-r from-brand-600 to-accent-500"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ========================= -->
      <!--   NUEVA SECCIÓN: GRÁFICOS  -->
      <!-- ========================= -->
      <section class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3" aria-label="Análisis estadístico">
        <!-- Evolución de citas (línea) -->
        <article class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
          <div class="mb-3 flex items-center justify-between">
            <h2 class="text-lg font-semibold">Evolución de citas (7 días)</h2>
            <span class="text-xs text-slate-500">Última semana</span>
          </div>
          <div class="chart-container">
            <canvas id="chCitasLinea" aria-label="Gráfico de línea de citas por día"></canvas>
          </div>
        </article>

        <!-- Distribución por especialidad (doughnut) -->
        <article class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
          <div class="mb-3 flex items-center justify-between">
            <h2 class="text-lg font-semibold">Citas por especialidad (hoy)</h2>
            <span class="text-xs text-slate-500">Top 5</span>
          </div>
          <div class="chart-container">
            <canvas id="chEspecialidadPie" aria-label="Gráfico de distribución de citas por especialidad"></canvas>
          </div>
          <div class="mt-4 flex flex-wrap gap-2 text-xs">
            <span class="rounded-full bg-slate-100 px-2 py-1">Cardiología</span>
            <span class="rounded-full bg-slate-100 px-2 py-1">Dermatología</span>
            <span class="rounded-full bg-slate-100 px-2 py-1">Pediatría</span>
            <span class="rounded-full bg-slate-100 px-2 py-1">Ginecología</span>
            <span class="rounded-full bg-slate-100 px-2 py-1">Oftalmología</span>
          </div>
        </article>

        <!-- No‑show por especialidad (horizontal bar) -->
        <article class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
          <div class="mb-3 flex items-center justify-between">
            <h2 class="text-lg font-semibold">No‑show por especialidad (semana)</h2>
            <span class="text-xs text-slate-500">%</span>
          </div>
          <div class="chart-container">
            <canvas id="chNoShowBar" aria-label="Gráfico de barras horizontal del no-show por especialidad"></canvas>
          </div>
        </article>

        <!-- Ocupación por sede (agrupado) -->
        <article class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft md:col-span-2 xl:col-span-2">
          <div class="mb-3 flex items-center justify-between">
            <h2 class="text-lg font-semibold">Ocupación por sede (semana)</h2>
            <span class="text-xs text-slate-500">Turnos: Mañana / Tarde / Noche</span>
          </div>
          <div class="chart-container">
            <canvas id="chOcupacionSede" aria-label="Gráfico de barras agrupadas de ocupación por sede"></canvas>
          </div>
        </article>

        <!-- Satisfacción promedio (barra) -->
        <article class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
          <div class="mb-3 flex items-center justify-between">
            <h2 class="text-lg font-semibold">Satisfacción promedio (mes)</h2>
            <span class="text-xs text-slate-500">Escala 1–5</span>
          </div>
          <div class="chart-container">
            <canvas id="chSatisfaccion" aria-label="Gráfico de barras de satisfacción por sede"></canvas>
          </div>
        </article>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="fixed bottom-0 inset-x-0 z-40 border-t border-slate-200 bg-white/90 backdrop-blur">
    <div class="mx-auto flex h-12 max-w-screen-2xl items-center justify-between px-6 text-sm text-slate-600">
      <p>© <span id="y"></span> NextIaCorp • Todos los derechos reservados</p>
      <nav class="hidden gap-4 md:flex">
        <a class="hover:text-slate-900" href="#">Privacidad</a>
        <a class="hover:text-slate-900" href="#">Términos</a>
        <a class="hover:text-slate-900" href="#">Contacto</a>
      </nav>
    </div>
  </footer>

  <script>
    // Rellenar año
    document.getElementById('y').textContent = new Date().getFullYear(); 
    // ==============================
    //    Inicialización de gráficos
    // ==============================
    window.addEventListener('load', () => {
      if (!window.Chart) {
        document.querySelectorAll('.chart-container').forEach(c => {
          c.innerHTML = '<div class="flex items-center justify-center h-full text-red-500 text-sm">Error: Chart.js no disponible</div>';
        });
        return;
      }
  
      // Defaults Chart.js (alineado a Tailwind)
      Chart.defaults.font.family =
        "ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji'";
      Chart.defaults.color = '#334155';        // slate-700
      Chart.defaults.borderColor = '#e2e8f0';  // slate-200
      Chart.defaults.responsive = true;
      Chart.defaults.maintainAspectRatio = false; // <— importante con .chart-container
  
      const COLORS = {
        brand: '#4f46e5',       // brand-600
        brandLight: '#a5b4fc',  // brand-300
        accent: '#06b6d4',      // accent-500
        accentLight: '#67e8f9', // accent-300
      };
  
      const makeGradient = (ctx, from, to) => {
        const g = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
        g.addColorStop(0, from);
        g.addColorStop(1, to);
        return g;
      };
  
      // 1) Evolución de citas (línea)
      const elLinea = document.getElementById('chCitasLinea');
      let chLinea;
      if (elLinea) {
        const ctx = elLinea.getContext('2d');
        const today = new Date();
        const dias = [...Array(7)].map((_, i) => {
          const d = new Date(today);
          d.setDate(today.getDate() - (6 - i));
          return d.toLocaleDateString('es-PE', { weekday: 'short' });
        });
        chLinea = new Chart(ctx, {
          type: 'line',
          data: {
            labels: dias,
            datasets: [{
              label: 'Citas',
              data: [88, 96, 110, 125, 132, 118, 128],
              tension: 0.35,
              fill: true,
              borderWidth: 2,
              borderColor: COLORS.brand,
              backgroundColor: makeGradient(ctx, 'rgba(79,70,229,0.25)', 'rgba(6,182,212,0.05)'),
              pointRadius: 3,
              pointBackgroundColor: '#fff',
              pointBorderColor: COLORS.brand,
            }]
          },
          options: {
            plugins: { legend: { display: false }, tooltip: { intersect: false, mode: 'index' } },
            scales: { x: { grid: { display: false } }, y: { beginAtZero: true, ticks: { stepSize: 20 } } }
          }
        });
      }
  
      // 2) Citas por especialidad (doughnut)
      const elPie = document.getElementById('chEspecialidadPie');
      if (elPie) {
        new Chart(elPie.getContext('2d'), {
          type: 'doughnut',
          data: {
            labels: ['Cardiología', 'Dermatología', 'Pediatría', 'Ginecología', 'Oftalmología'],
            datasets: [{
              data: [32, 26, 22, 18, 15],
              backgroundColor: [COLORS.brand, COLORS.accent, '#10b981', '#f59e0b', '#ef4444'],
              borderWidth: 1,
              borderColor: '#ffffff'
            }]
          },
          options: { plugins: { legend: { position: 'bottom' } }, cutout: '62%' }
        });
      }
  
      // 3) No-show por especialidad (horizontal bar)
      const elNoShow = document.getElementById('chNoShowBar');
      if (elNoShow) {
        new Chart(elNoShow.getContext('2d'), {
          type: 'bar',
          data: {
            labels: ['Cardiología', 'Dermatología', 'Pediatría', 'Ginecología', 'Oftalmología'],
            datasets: [{ label: '% No-show', data: [2.1, 3.8, 4.5, 2.9, 3.2], backgroundColor: COLORS.accent, borderRadius: 8, maxBarThickness: 22 }]
          },
          options: {
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            scales: { x: { beginAtZero: true, ticks: { callback: v => v + '%' } }, y: { grid: { display: false } } }
          }
        });
      }
  
      // 4) Ocupación por sede (agrupado)
      const elOcup = document.getElementById('chOcupacionSede');
      if (elOcup) {
        new Chart(elOcup.getContext('2d'), {
          type: 'bar',
          data: {
            labels: ['Miraflores', 'San Isidro', 'Surco'],
            datasets: [
              { label: 'Mañana', data: [86, 79, 81], backgroundColor: COLORS.brand, borderRadius: 6, maxBarThickness: 28 },
              { label: 'Tarde', data: [78, 83, 75], backgroundColor: COLORS.accent, borderRadius: 6, maxBarThickness: 28 },
              { label: 'Noche', data: [65, 72, 68], backgroundColor: '#64748b', borderRadius: 6, maxBarThickness: 28 }
            ]
          },
          options: {
            plugins: { legend: { position: 'bottom' } },
            scales: { y: { beginAtZero: true, ticks: { callback: v => v + '%' } } }
          }
        });
      }
  
      // 5) Satisfacción promedio (barra)
      const elSat = document.getElementById('chSatisfaccion');
      if (elSat) {
        const ctxSat = elSat.getContext('2d');
        new Chart(ctxSat, {
          type: 'bar',
          data: {
            labels: ['Miraflores', 'San Isidro', 'Surco'],
            datasets: [{
              label: 'Puntaje',
              data: [4.8, 4.6, 4.7],
              backgroundColor: makeGradient(ctxSat, 'rgba(6,182,212,0.45)', 'rgba(79,70,229,0.45)'),
              borderRadius: 8,
              maxBarThickness: 28
            }]
          },
          options: { plugins: { legend: { display: false } }, scales: { y: { suggestedMin: 0, suggestedMax: 5, ticks: { stepSize: 1 } } } }
        });
      }
  
      // Botón "Actualizar" (demo)
      const refreshBtn = Array.from(document.querySelectorAll('button')).find(b => b.textContent.trim() === 'Actualizar');
      if (refreshBtn && chLinea) {
        refreshBtn.addEventListener('click', () => {
          refreshBtn.disabled = true;
          const old = refreshBtn.textContent;
          refreshBtn.textContent = 'Actualizando…';
          setTimeout(() => {
            chLinea.data.datasets[0].data = chLinea.data.datasets[0].data.map(v =>
              Math.max(60, Math.min(160, v + (Math.random()*20 - 10)))
            );
            chLinea.update();
            refreshBtn.textContent = old;
            refreshBtn.disabled = false;
          }, 800);
        });
      }
  
      // Auto-update cada 5 min (demo) — ¡paréntesis corregido!
      setInterval(() => {
        if (chLinea) {
          const newData = chLinea.data.datasets[0].data.map(v =>
            Math.max(60, Math.min(160, v + (Math.random()*6 - 3)))
          );
          chLinea.data.datasets[0].data = newData;
          chLinea.update('none');
          const lastUpdateEl = document.getElementById('lastUpdate');
          if (lastUpdateEl) lastUpdateEl.textContent = 'Hace 1 min';
        }
      }, 300000);
  
      // Actualiza el “Hace X min” cada minuto (opcional)
      function updateLastUpdateTime() {
        const el = document.getElementById('lastUpdate');
        if (!el) return;
        el.textContent = 'Hace ' + Math.max(1, Math.floor((Date.now() % (5*60*1000))/60000)) + ' min';
      }
      setInterval(updateLastUpdateTime, 60000);
    });
  </script>
  
</body>
</html>
