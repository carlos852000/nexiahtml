<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NextIaDoctor • IPRESS • Bandeja de Reserva de Citas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' },
            accent: { 50: '#ecfeff', 100: '#cffafe', 200: '#a5f3fc', 300: '#67e8f9', 400: '#22d3ee', 500: '#06b6d4', 600: '#0891b2', 700: '#0e7490', 800: '#155e75', 900: '#164e63' }
          },
          boxShadow: { soft: '0 8px 24px rgba(2, 6, 23, 0.06)' }
        }
      }
    }
  </script>
  <style>
    * { scrollbar-width: thin; scrollbar-color: #cbd5e1 transparent }
    *::-webkit-scrollbar { height: 8px; width: 8px }
    *::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 8px }
    .scrollbar-hide::-webkit-scrollbar { display: none }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none }
  </style>
</head>

<body class="min-h-screen bg-slate-50 text-slate-800">
  <!-- Topbar con info IPRESS -->
  <header class="fixed inset-x-0 top-0 z-40 bg-gradient-to-r from-brand-600 to-accent-500 text-white shadow-soft">
    <div class="mx-auto flex h-16 max-w-screen-2xl items-center px-4">
      <div class="flex-1 flex items-center gap-4">
        <a href="dashboard.html" class="inline-flex items-center gap-3">
          <div class="select-none text-lg font-semibold tracking-wide">NextIaCorp</div>
        </a>
        <!-- Chip de IPRESS activa -->
        <div class="hidden md:flex items-center gap-2 rounded-lg bg-white/20 px-4 py-1.5 shadow-sm backdrop-blur-sm">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-white">
            <path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
          </svg>
          <span class="font-semibold text-white">Ipress San Martín</span>
          <!--<span class="hidden text-xs text-white/70 md:inline">•</span>
          <span class="hidden text-xs text-white/95 md:inline">RUC 20123456789</span>-->
        </div>
      </div>
      <nav class="flex items-center gap-2" aria-label="Navegación superior">
        <a href="reportes.html" class="hidden rounded-lg bg-white/10 px-3 py-1.5 text-sm font-medium backdrop-blur hover:bg-white/20 md:inline">Reportes</a>
        <a href="soporte.html" class="hidden rounded-lg bg-white/10 px-3 py-1.5 text-sm font-medium backdrop-blur hover:bg-white/20 md:inline">Soporte</a>
        <img src="https://api.dicebear.com/7.x/initials/svg?seed=ND" alt="avatar" class="h-8 w-8 rounded-full ring-2 ring-white/30" />
      </nav>
    </div>
  </header>

  <!-- Menú Nivel 1 • IPRESS seleccionada (Servicios activo) -->
  <nav class="fixed top-16 inset-x-0 z-30 bg-white border-b border-slate-200 shadow-soft">
    <div class="mx-auto max-w-screen-2xl px-4">
      <div class="flex items-center justify-between">
        <!-- Tabs/menú de la IPRESS -->
        <div class="flex items-center overflow-x-auto py-2 gap-2 scrollbar-hide">
          <a href="ipress-dashboard.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6"/></svg><span>Dashboard</span></a>

          <a href="ipress-sedes.html"  class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg><span>Sedes</span><span class="ml-1 rounded-full bg-brand-100 px-1.5 py-0.5 text-xs font-medium text-brand-800">5</span></a>

          <a href="ipress-usuarios.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg><span>Usuarios</span></a>

          <a href="ipress-medicos.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M4 7a4 4 0 118 0 4 4 0 01-8 0zm12 4h4m-2-2v4m-6 4a6 6 0 10-12 0"/></svg><span>Médicos</span></a>

          <a href="ipress-servicios.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg><span>Servicios</span></a>
          
          <a href="ipress-configuracion.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.757.427 1.757 2.925 0 3.351a1.724 1.724 0 00-1.066 2.572c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.757-2.924 1.757-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.757-.426-1.757-2.924 0-3.35.427-.427.684-1.03 1.065-2.573-.94-1.543.826-3.31 2.37-2.37.94.54 2.146.27 2.573-1.066z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg><span>Configuración</span></a>
        
        </div>

        <!-- Acciones rápidas a la derecha -->
        <div class="flex items-center gap-2">
          <a href="ipress-agenda.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 002-2v-6H3v6a2 2 0 002 2z"/></svg><span>Agenda</span></a>
          <a href="ipress-reserva.html" aria-current="page" class="flex items-center gap-2 rounded-lg bg-brand-50 px-3 py-2 text-sm font-medium text-brand-700 border-b-2 border-brand-600 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m6-6H6"/></svg><span>Reservas</span></a>
          <a href="ipress-atenciones.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg><span>Atenciones</span></a>
          <a href="ipress-reportes.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 14l9-5-9-5-9 5 9 5z"/><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 14l6.16-3.422A12.083 12.083 0 016 8.577M12 14v7"/></svg><span>Reportes</span></a>
        </div>
      </div>
    </div>
  </nav>


  <!-- Main -->
  <main class="pt-36 pb-24">
    <div class="mx-auto max-w-screen-2xl px-6">

      <!-- Stepper -->
      <div class="mb-6 grid grid-cols-3 gap-3">
        <div id="s1wrap" class="rounded-2xl bg-white p-3 shadow-soft ring-1 ring-slate-200 transition-all duration-300">
          <div class="flex items-center gap-3">
            <span id="s1" class="grid h-7 w-7 place-items-center rounded-full bg-brand-600 text-xs font-semibold text-white ring-2 ring-brand-100">1</span>
            <div>
              <p class="text-xs text-brand-600 font-medium">Paso 1</p>
              <p class="text-sm font-medium text-slate-800">Buscar disponibilidad</p>
            </div>
          </div>
        </div>
        <div id="s2wrap" class="rounded-2xl bg-white p-3 shadow-soft ring-1 ring-slate-200 opacity-60 transition-all duration-300">
          <div class="flex items-center gap-3">
            <span id="s2" class="grid h-7 w-7 place-items-center rounded-full bg-slate-200 text-xs font-semibold text-slate-500">2</span>
            <div>
              <p class="text-xs text-slate-500">Paso 2</p>
              <p class="text-sm font-medium text-slate-600">Datos del paciente</p>
            </div>
          </div>
        </div>
        <div id="s3wrap" class="rounded-2xl bg-white p-3 shadow-soft ring-1 ring-slate-200 opacity-60 transition-all duration-300">
          <div class="flex items-center gap-3">
            <span id="s3" class="grid h-7 w-7 place-items-center rounded-full bg-slate-200 text-xs font-semibold text-slate-500">3</span>
            <div>
              <p class="text-xs text-slate-500">Paso 3</p>
              <p class="text-sm font-medium text-slate-600">Confirmación</p>
            </div>
          </div>
        </div>
      </div>

      <!-- PASO 1: Buscar disponibilidad -->
      <section id="step1" class="grid gap-6 lg:grid-cols-12">
        <!-- filtros -->
        <aside class="lg:col-span-5 rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
          <h2 class="text-lg font-semibold">Completa los detalles para buscar una cita</h2>
          <p class="mb-4 text-sm text-slate-500">Selecciona sede, modalidad, especialidad, médico y fecha preferidos.</p>
          <div class="grid gap-4 md:grid-cols-2">
            <div>
              <label class="text-xs font-medium text-slate-500">Sede</label>
              <select id="fSede" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-500"><option>Clínica Central</option><option>Centro Médico Norte</option><option>Centro Médico Sur</option></select>
            </div>
            <div>
              <label class="text-xs font-medium text-slate-500">Modalidad</label>
              <select id="fModalidad" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-500"><option>Presencial</option><option>Virtual</option></select>
            </div>
            <div>
              <label class="text-xs font-medium text-slate-500">Especialidad</label>
              <select id="fEspecialidad" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-500"><option>Cardiología</option><option>Neumología</option><option>Pediatría</option><option>Dermatología</option></select>
            </div>
            <div>
              <label class="text-xs font-medium text-slate-500">Médico</label>
              <select id="fMedico" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-500"><option>Seleccionar automáticamente</option><option>Dr. Oscar Aguirre</option><option>Dr. Juanito Pérez</option><option>Dra. Ana López</option></select>
            </div>
            <div class="md:col-span-2">
              <label class="text-xs font-medium text-slate-500">Fecha</label>
              <input id="fFecha" type="date" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-brand-500" />
            </div>
          </div>
          <div class="mt-4 flex items-center justify-end">
            <button id="btnBuscar" class="rounded-lg bg-emerald-600 px-5 py-2 text-sm font-semibold text-white shadow-soft hover:bg-emerald-700">Buscar</button>
          </div>
        </aside>

        <!-- resultados y selección -->
        <section class="lg:col-span-7 space-y-4">
          <div id="hintResultados" class="rounded-2xl border border-dashed border-slate-300 bg-white p-5 text-center text-slate-500 shadow-soft">
            Usa los filtros y presiona <span class="font-medium text-slate-700">Buscar</span> para ver médicos disponibles.
          </div>

          <div id="resultados" class="hidden space-y-4">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold">Médicos disponibles</h3>
              <div id="estadoSeleccion" class="text-sm text-slate-500">
                <span class="flex items-center gap-2">
                  <div class="h-2 w-2 rounded-full bg-slate-300"></div>
                  <span>Sin selección</span>
                </span>
              </div>
            </div>
            <!-- Cards de médicos -->
            <div id="listaMedicos" class="space-y-3"></div>

            <!-- Fecha (chips) y horarios -->
            <div id="panelFechas" class="hidden rounded-2xl border border-slate-200 bg-white p-4 shadow-soft">
              <div id="chipsFechas" class="mb-3 flex flex-wrap gap-2"></div>
              <div id="slots" class="grid grid-cols-3 gap-2 sm:grid-cols-4 md:grid-cols-5"></div>
              <div class="mt-3 flex items-center justify-between text-xs">
              <div class="flex items-center gap-3">
                <span class="flex items-center gap-1">
                  <div class="h-2 w-2 rounded-full bg-brand-500"></div>
                  <span class="text-slate-500">Médico seleccionado</span>
                </span>
                <span class="flex items-center gap-1">
                  <div class="h-2 w-2 rounded-full bg-accent-500"></div>
                  <span class="text-slate-500">Fecha seleccionada</span>
                </span>
                <span class="flex items-center gap-1">
                  <div class="h-2 w-2 rounded-full bg-emerald-500"></div>
                  <span class="text-slate-500">Hora seleccionada</span>
                </span>
              </div>
              <p id="fechaElegidaTxt" class="text-slate-500"></p>
            </div>
            </div>

            <div class="flex items-center justify-end">
              <button id="btnSiguiente1" disabled class="rounded-lg bg-slate-200 px-5 py-2 text-sm font-semibold text-white shadow-soft disabled:cursor-not-allowed">Siguiente</button>
            </div>
          </div>
        </section>
      </section>

      <!-- PASO 2: Datos del paciente -->
      <section id="step2" class="hidden">
        <div class="grid gap-6 lg:grid-cols-12">
          <div class="lg:col-span-8 space-y-6">
            <!-- Info Paciente -->
            <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
              <h2 class="text-lg font-semibold">Completa los datos del Paciente</h2>
              <div class="mt-4 grid gap-4 md:grid-cols-2">
                <div class="md:col-span-2 flex gap-2">
                  <input id="pBuscar" class="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm" placeholder="Buscar paciente por nombre o documento" />
                  <button class="rounded-lg border border-slate-200 px-4 py-2 text-sm hover:bg-slate-50">Buscar</button>
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">Nombre</label>
                  <input id="pNombre" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm" placeholder="Nombre del paciente" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">Apellido</label>
                  <input id="pApellido" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm" placeholder="Apellido del paciente" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">Correo Electrónico</label>
                  <input id="pEmail" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm" placeholder="correo@ejemplo.com" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">Teléfono</label>
                  <input id="pTelefono" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm" placeholder="+51 999 999 999" />
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">Fecha de Nacimiento</label>
                  <input id="pNacimiento" type="date" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm" />
                </div>
              </div>
            </div>

            <!-- Aseguradora -->
            <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
              <h3 class="text-base font-semibold">Detalles de Aseguradora</h3>
              <div class="mt-3 grid gap-4 md:grid-cols-2">
                <div>
                  <label class="text-xs font-medium text-slate-500">Aseguradora</label>
                  <select id="aSeguro" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-500"><option>Ninguna</option><option>Rímac</option><option>Pacífico</option><option>Mapfre</option></select>
                </div>
                <div>
                  <label class="text-xs font-medium text-slate-500">Número de Póliza</label>
                  <input id="aPoliza" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm" placeholder="Ingrese el número de póliza" />
                </div>
              </div>
            </div>

            <!-- Pagos -->
            <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
              <div class="flex items-center justify-between">
                <h3 class="text-base font-semibold">Agregar Pago</h3>
                <div class="text-right text-2xl font-semibold text-slate-700">Total <span id="totalTxt">S/. 50.00</span></div>
              </div>
              <div class="mt-3 grid gap-4">
                <div class="grid grid-cols-2 gap-4 text-sm">
                  <label class="inline-flex items-center gap-2"><input type="radio" name="pago" id="pagoAdelanto" checked/> Pagar consulta o Adelanto</label>
                  <label class="inline-flex items-center gap-2"><input type="radio" name="pago" id="pagoConsultorio"/> Pago en Consultorio</label>
                </div>

                <div id="panelAdelanto" class="grid gap-3 md:grid-cols-3">
                  <div>
                    <label class="text-xs font-medium text-slate-500">Tipo de Modalidad de Pago</label>
                    <select id="mPago" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm"><option>Tarjeta de Crédito</option><option>Tarjeta de Débito</option><option>Yape</option></select>
                  </div>
                  <div>
                    <label class="text-xs font-medium text-slate-500">Monto de Pago (Adelanto)</label>
                    <div class="mt-1 flex items-center gap-2"><span class="rounded-lg bg-slate-100 px-2 py-2 text-sm">S/.</span><input id="montoPago" value="30.00" class="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm" /></div>
                  </div>
                  <div class="flex flex-col justify-end">
                    <button class="rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm hover:bg-slate-50">Adjuntar Constancia</button>
                  </div>
                </div>

                <div class="flex items-center justify-between rounded-xl bg-slate-50 p-3 text-sm">
                  <span class="text-slate-500">Pendiente</span>
                  <span id="pendienteTxt" class="text-lg font-semibold text-rose-600">S/. 20.00</span>
                </div>

                <div class="flex items-center justify-between">
                  <button id="btnVolver1" class="rounded-lg border border-slate-200 bg-white px-5 py-2 text-sm hover:bg-slate-50">Volver</button>
                  <button id="btnReservar" class="rounded-lg bg-emerald-600 px-5 py-2 text-sm font-semibold text-white shadow-soft hover:bg-emerald-700">Reservar Cita</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Resumen sticky -->
          <aside class="lg:col-span-4">
            <div class="sticky top-24 rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
              <h4 class="text-sm font-semibold">Resumen de Selección</h4>
              <div id="resumenSel" class="mt-3 space-y-2 text-sm text-slate-600">
                <p>Doctor: —</p>
                <p>Especialidad: —</p>
                <p>Fecha y hora: —</p>
                <p>Modalidad: —</p>
                <p>Ubicación: —</p>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <!-- PASO 3: Confirmación -->
      <section id="step3" class="hidden">
        <div class="mx-auto max-w-3xl space-y-6">
          <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-soft">
            <h2 class="mb-4 text-2xl font-semibold text-center">Confirmación de Cita</h2>
            <div class="grid gap-6 md:grid-cols-2">
              <div class="flex items-start gap-3">
                <img id="cFoto" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Doc" class="h-12 w-12 rounded-full"/>
                <div>
                  <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Médico</p>
                  <p class="text-base font-medium" id="cDoctor">—</p>
                  <p class="text-sm text-slate-500" id="cEsp">—</p>
                </div>
              </div>
              <div>
                <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Fecha y Hora</p>
                <p class="text-base font-medium" id="cFecha">—</p>
              </div>
              <div>
                <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Ubicación y Modalidad</p>
                <p class="text-base font-medium" id="cUbi">—</p>
              </div>
              <div>
                <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Datos del Paciente</p>
                <p class="text-base font-medium" id="cPaciente">—</p>
              </div>
            </div>
          </div>

          <div class="rounded-2xl border border-slate-200 bg-white p-6 text-center shadow-soft">
            <div class="mx-auto max-w-xl rounded-xl bg-emerald-50 p-4 text-sm text-emerald-800">Se ha enviado un correo de confirmación con los detalles de su cita a <span id="cEmail" class="font-medium">—</span>.</div>
            <div class="mt-6 grid place-items-center">
              <div>
                <p class="mb-2 text-xs font-semibold uppercase tracking-wide text-slate-500">Código QR de la Cita</p>
                <img id="qr" class="mx-auto h-44 w-44 rounded-xl border border-slate-200 bg-white p-2" alt="QR"/>
                <p class="mt-2 text-xs text-slate-500">Escanee para verificar detalles o ingreso.</p>
              </div>
            </div>
            <div class="mt-6">
              <a href="ipress-reserva.html" class="inline-flex items-center gap-2 rounded-lg bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow-soft hover:bg-slate-800">Ir a la Bandeja de Reservas</a>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer class="fixed bottom-0 left-64 right-0 z-40 border-t border-slate-200 bg-white/90 backdrop-blur">
    <div class="mx-auto flex h-12 max-w-screen-2xl items-center justify-between px-6 text-sm text-slate-600">
      <p>© <span id="y"></span> NextIaCorp • Todos los derechos reservados</p>
      <nav class="hidden gap-4 md:flex">
        <a class="hover:text-slate-900" href="privacidad.html">Privacidad</a>
        <a class="hover:text-slate-900" href="terminos.html">Términos</a>
        <a class="hover:text-slate-900" href="contacto.html">Contacto</a>
      </nav>
    </div>
  </footer>

  <script>
    // Año + logo
    document.getElementById('y').textContent = new Date().getFullYear();
    // Estado global
    const state = {
      filtros: { sede:null, modalidad:null, esp:null, medico:null, fecha:null },
      doctor: null, fecha: null, hora: null,
      total: 50.00, pagado: 30.00, modalidadPago: 'Tarjeta de Crédito'
    };

    // utilidades fecha
    function fmtDate(d){ return d.toLocaleDateString('es-PE',{ day:'numeric', month:'long', year:'numeric'}); }

    // PASO 1
    const btnBuscar = document.getElementById('btnBuscar');
    const resultados = document.getElementById('resultados');
    const hintResultados = document.getElementById('hintResultados');
    const listaMedicos = document.getElementById('listaMedicos');
    const panelFechas = document.getElementById('panelFechas');
    const chipsFechas = document.getElementById('chipsFechas');
    const slots = document.getElementById('slots');
    const fechaElegidaTxt = document.getElementById('fechaElegidaTxt');
    const btnSiguiente1 = document.getElementById('btnSiguiente1');

    btnBuscar.onclick = () => {
      // tomar filtros
      state.filtros = {
        sede: document.getElementById('fSede').value,
        modalidad: document.getElementById('fModalidad').value,
        esp: document.getElementById('fEspecialidad').value,
        medico: document.getElementById('fMedico').value,
        fecha: document.getElementById('fFecha').value
      };

      // mock: armar lista de médicos
      const docs = [
        { id:1, nombre:'Dr(a). Oscar Nelson Aguirre Zurita', esp:'Cardiología', cmp:'CMP:035675 RNE:016619', foto:'https://images.unsplash.com/photo-1537368910025-700350fe46c7?w=96&q=80' },
        { id:2, nombre:'Dr(a). Juanito Perez Lopez', esp:'Neumología', cmp:'CMP:035675 RNE:016619', foto:'https://images.unsplash.com/photo-1550831107-1553da8c8464?w=96&q=80' },
        { id:3, nombre:'Dra. Ana María López', esp:'Pediatría', cmp:'CMP:041245', foto:'https://images.unsplash.com/photo-1537368910025-700350fe46c7?w=96&q=80' }
      ];
      // si usuario eligió médico específico, priorizarlo primero
      const chosen = state.filtros.medico && state.filtros.medico!=='Seleccionar automáticamente' ? docs.filter(d=>d.nombre.includes(state.filtros.medico)) : docs;

      listaMedicos.innerHTML = '';
      chosen.forEach(doc=>{
        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'w-full rounded-2xl border border-slate-200 bg-white p-4 text-left shadow-soft hover:ring-1 hover:ring-brand-300 transition-all duration-200 hover:shadow-lg';
        card.innerHTML = `
          <div class='flex items-center gap-4'>
            <img src='${doc.foto}' class='h-16 w-16 rounded-full object-cover shadow-soft'/>
            <div class='flex-1'>
              <p class='font-medium text-slate-800'>${doc.nombre}</p>
              <p class='text-sm text-slate-500'>${doc.esp} • ${doc.cmp}</p>
            </div>
            <span class='rounded-full bg-slate-100 px-3 py-1 text-xs font-medium text-slate-600'>Seleccionar</span>
          </div>`;
        card.onclick = ()=> selectDoctor(doc);
        listaMedicos.appendChild(card);
      });

      hintResultados.classList.add('hidden');
      resultados.classList.remove('hidden');
      panelFechas.classList.add('hidden');
      btnSiguiente1.disabled = true; btnSiguiente1.classList.add('bg-slate-200'); btnSiguiente1.classList.remove('bg-emerald-600');
      
      // Resetear estado visual
      const estadoSeleccion = document.getElementById('estadoSeleccion');
      estadoSeleccion.innerHTML = `
        <span class="flex items-center gap-2">
          <div class="h-2 w-2 rounded-full bg-slate-300"></div>
          <span>Sin selección</span>
        </span>
      `;
      
      setStep(1);
    };

    function selectDoctor(doc){
      state.doctor = doc; state.hora=null; state.fecha=null;
      
      // Remover selección previa de todos los médicos
      Array.from(listaMedicos.children).forEach(card => {
        card.classList.remove('bg-brand-50', 'border-brand-300', 'ring-2', 'ring-brand-500/20');
        card.classList.add('border-slate-200', 'bg-white');
      });
      
      // Aplicar selección al médico elegido
      const selectedCard = Array.from(listaMedicos.children).find(card => 
        card.querySelector('p').textContent === doc.nombre
      );
      if (selectedCard) {
        selectedCard.classList.add('bg-brand-50', 'border-brand-300', 'ring-2', 'ring-brand-500/20');
        selectedCard.classList.remove('border-slate-200', 'bg-white');
      }
      
      // Actualizar estado visual
      const estadoSeleccion = document.getElementById('estadoSeleccion');
      estadoSeleccion.innerHTML = `
        <span class="flex items-center gap-2">
          <div class="h-2 w-2 rounded-full bg-brand-500"></div>
          <span class="text-brand-700 font-medium">Médico seleccionado: ${doc.nombre.split(' ').slice(0, 2).join(' ')}</span>
        </span>
      `;
      
      renderFechas(); renderResumen();
    }

    function renderFechas(){
      panelFechas.classList.remove('hidden'); chipsFechas.innerHTML=''; slots.innerHTML='';
      const base = document.getElementById('fFecha').value ? new Date(document.getElementById('fFecha').value) : new Date();
      for(let i=0;i<5;i++){
        const d = new Date(base); d.setDate(d.getDate()+i);
        const chip = document.createElement('button'); chip.type='button';
        chip.className = 'rounded-xl border border-slate-200 bg-white px-3 py-2 text-center text-xs hover:bg-slate-50 transition-all duration-200 cursor-pointer text-slate-700';
        chip.innerHTML = `<div class='text-slate-500 uppercase'>${d.toLocaleDateString('es-PE',{ month:'short'}).toUpperCase()}</div><div class='text-2xl font-semibold'>${d.getDate()}</div><div class='text-slate-500 uppercase'>${d.toLocaleDateString('es-PE',{ weekday:'short'}).toUpperCase()}</div>`;
        chip.onclick = ()=> selectFecha(d);
        chipsFechas.appendChild(chip);
      }
      fechaElegidaTxt.textContent = '';
    }

    function selectFecha(d){
      state.fecha = d; fechaElegidaTxt.textContent = d.toLocaleDateString('es-PE',{ weekday:'long', day:'numeric', month:'long'});
      
      // Remover selección previa de todas las fechas
      Array.from(chipsFechas.children).forEach(chip => {
        chip.classList.remove('bg-accent-50', 'border-accent-300', 'text-accent-900', 'ring-2', 'ring-accent-500/20');
        chip.classList.add('border-slate-200', 'bg-white', 'text-slate-700');
      });
      
      // Aplicar selección a la fecha elegida
      const selectedChip = Array.from(chipsFechas.children).find(chip => {
        const chipDate = chip.querySelector('div:nth-child(2)').textContent;
        return parseInt(chipDate) === d.getDate();
      });
      if (selectedChip) {
        selectedChip.classList.add('bg-accent-50', 'border-accent-300', 'text-accent-900', 'ring-2', 'ring-accent-500/20');
        selectedChip.classList.remove('border-slate-200', 'bg-white', 'text-slate-700');
      }
      
      // Actualizar estado visual de fecha
      const estadoSeleccion = document.getElementById('estadoSeleccion');
      const fechaTexto = d.toLocaleDateString('es-PE', { weekday: 'long', day: 'numeric', month: 'long' });
      estadoSeleccion.innerHTML = `
        <span class="flex items-center gap-2">
          <div class="h-2 w-2 rounded-full bg-accent-500"></div>
          <span class="text-accent-700 font-medium">Fecha seleccionada: ${fechaTexto}</span>
        </span>
      `;
      
      renderSlots();
    }

    function renderSlots(){
      slots.innerHTML = '';
      const times = ['09:00','09:30','10:00','11:30','14:00','14:30'];
      times.forEach(t=>{
        const b = document.createElement('button'); 
        b.type='button'; 
        b.className='rounded-lg border border-slate-200 px-4 py-2 text-sm hover:bg-slate-50 cursor-pointer transition-all duration-200'; 
        b.textContent=t; 
        b.onclick=()=>selectHora(t,b);
        slots.appendChild(b);
      });
    }

    function selectHora(t,btn){
      state.hora = t; 
      
      // Remover selección previa de todas las horas
      Array.from(slots.children).forEach(x => {
        x.classList.remove('bg-emerald-50', 'border-emerald-300', 'text-emerald-900', 'ring-2', 'ring-emerald-500/20');
        x.classList.add('border-slate-200', 'bg-white', 'text-slate-700');
      }); 
      
      // Aplicar selección a la hora elegida
      btn.classList.add('bg-emerald-50', 'border-emerald-300', 'text-emerald-900', 'ring-2', 'ring-emerald-500/20');
      btn.classList.remove('border-slate-200', 'bg-white', 'text-slate-700');
      
      // Actualizar estado visual de hora
      const estadoSeleccion = document.getElementById('estadoSeleccion');
      estadoSeleccion.innerHTML = `
        <span class="flex items-center gap-2">
          <div class="h-2 w-2 rounded-full bg-emerald-500"></div>
          <span class="text-emerald-700 font-medium">Hora seleccionada: ${t}</span>
        </span>
      `;
      
      btnSiguiente1.disabled = false; btnSiguiente1.classList.remove('bg-slate-200'); btnSiguiente1.classList.add('bg-emerald-600'); btnSiguiente1.textContent='Siguiente';
      renderResumen();
    }

    btnSiguiente1.onclick = ()=>{ if(!state.hora || !state.doctor) return; setStep(2); };

    // PASO 2
    const totalTxt = document.getElementById('totalTxt');
    const pendienteTxt = document.getElementById('pendienteTxt');
    const montoPago = document.getElementById('montoPago');
    const pagoAdelanto = document.getElementById('pagoAdelanto');
    const pagoConsultorio = document.getElementById('pagoConsultorio');
    const panelAdelanto = document.getElementById('panelAdelanto');

    function updatePagoUI(){
      panelAdelanto.style.display = pagoAdelanto.checked ? 'grid' : 'none';
      const pagado = pagoAdelanto.checked ? parseFloat(montoPago.value||0) : 0;
      state.pagado = isNaN(pagado)?0:pagado; const pendiente = Math.max(0,(state.total - state.pagado));
      totalTxt.textContent = `S/. ${state.total.toFixed(2)}`;
      pendienteTxt.textContent = `S/. ${pendiente.toFixed(2)}`;
    }
    pagoAdelanto.onchange = updatePagoUI; pagoConsultorio.onchange = updatePagoUI; montoPago.oninput = updatePagoUI; updatePagoUI();

    document.getElementById('btnVolver1').onclick = (e)=>{ e.preventDefault(); setStep(1); };

    document.getElementById('btnReservar').onclick = (e)=>{
      e.preventDefault();
      // Validaciones mínimas
      const nombre = document.getElementById('pNombre').value.trim();
      const apellido = document.getElementById('pApellido').value.trim();
      const email = document.getElementById('pEmail').value.trim();
      if(!nombre || !apellido || !email){ alert('Completa al menos Nombre, Apellido y Correo.'); return; }
      state.paciente = { nombre, apellido, email, telefono: document.getElementById('pTelefono').value.trim() };
      // armar QR
      const payload = encodeURIComponent(JSON.stringify({ doctor: state.doctor.nombre, esp: state.doctor.esp, fecha: fmtDate(state.fecha), hora: state.hora, sede: state.filtros.sede }));
      document.getElementById('qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${payload}`;
      // Cargar datos de confirmación
      document.getElementById('cDoctor').textContent = state.doctor.nombre;
      document.getElementById('cEsp').textContent = state.doctor.esp;
      document.getElementById('cFecha').textContent = `${fmtDate(state.fecha)} • ${state.hora}`;
      document.getElementById('cUbi').textContent = `${state.filtros.sede}, ${state.filtros.modalidad}`;
      document.getElementById('cPaciente').textContent = `${state.paciente.nombre} ${state.paciente.apellido}\n${state.paciente.email}${state.paciente.telefono?`\n${state.paciente.telefono}`:''}`;
      document.getElementById('cEmail').textContent = state.paciente.email;
      document.getElementById('cFoto').src = state.doctor.foto;
      setStep(3);
    };

    // Resumen lateral del paso 2
    function renderResumen(){
      const r = document.getElementById('resumenSel');
      r.innerHTML = `
        <p>Doctor: <span class='font-medium'>${state.doctor?state.doctor.nombre:'—'}</span></p>
        <p>Especialidad: <span class='font-medium'>${state.doctor?state.doctor.esp:'—'}</span></p>
        <p>Fecha y hora: <span class='font-medium'>${state.fecha?fmtDate(state.fecha):'—'} ${state.hora?('• '+state.hora):''}</span></p>
        <p>Modalidad: <span class='font-medium'>${state.filtros.modalidad||'—'}</span></p>
        <p>Ubicación: <span class='font-medium'>${state.filtros.sede||'—'}</span></p>
      `;
    }

    // Stepper control
    function setStep(n){
      // visual stepper - aplicar estilos según el paso
      [1,2,3].forEach(i=>{ 
        const stepEl = document.getElementById('s'+i);
        const stepWrap = document.getElementById('s'+i+'wrap');
        
        if (i === n) {
          // Paso activo
          stepEl.className = 'grid h-7 w-7 place-items-center rounded-full bg-brand-600 text-xs font-semibold text-white ring-2 ring-brand-100';
          stepWrap.className = 'rounded-2xl bg-brand-50 p-3 shadow-soft ring-2 ring-brand-200 transition-all duration-300 step-active';
          stepWrap.querySelector('p:first-child').className = 'text-xs text-brand-600 font-medium';
          stepWrap.querySelector('p:last-child').className = 'text-sm font-medium text-slate-800';
        } else if (i < n) {
          // Pasos completados
          stepEl.className = 'grid h-7 w-7 place-items-center rounded-full bg-emerald-500 text-xs font-semibold text-white ring-2 ring-emerald-100';
          stepWrap.className = 'rounded-2xl bg-emerald-50 p-3 shadow-soft ring-1 ring-emerald-200 transition-all duration-300 step-completed';
          stepWrap.querySelector('p:first-child').className = 'text-xs text-emerald-600 font-medium';
          stepWrap.querySelector('p:last-child').className = 'text-sm font-medium text-slate-700';
        } else {
          // Pasos pendientes
          stepEl.className = 'grid h-7 w-7 place-items-center rounded-full bg-slate-200 text-xs font-semibold text-slate-500';
          stepWrap.className = 'rounded-2xl bg-white p-3 shadow-soft ring-1 ring-slate-200 opacity-60 transition-all duration-300 step-pending';
          stepWrap.querySelector('p:first-child').className = 'text-xs text-slate-500';
          stepWrap.querySelector('p:last-child').className = 'text-sm font-medium text-slate-600';
        }
      });
      
      // show sections
      document.getElementById('step1').classList.toggle('hidden', n!==1);
      document.getElementById('step2').classList.toggle('hidden', n!==2);
      document.getElementById('step3').classList.toggle('hidden', n!==3);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Initialize UI
    setStep(1);
  </script>
</body>
</html>
