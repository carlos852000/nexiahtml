<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NextIaDoctor • Sede • Especialidad (Formulario)</title>
  <!-- Tailwind para prototipo -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81'},
            accent: {50:'#ecfeff',100:'#cffafe',200:'#a5f3fc',300:'#67e8f9',400:'#22d3ee',500:'#06b6d4',600:'#0891b2',700:'#0e7490',800:'#155e75',900:'#164e63'}
          },
          boxShadow: { soft:'0 8px 24px rgba(2,6,23,.06)'}
        }
      }
    }
  </script>
  <style>
    *{ scrollbar-width: thin; scrollbar-color: #cbd5e1 transparent; }
    *::-webkit-scrollbar{height:8px;width:8px}
    *::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:8px}
    .scrollbar-hide::-webkit-scrollbar{display:none}
    .scrollbar-hide{ -ms-overflow-style:none; scrollbar-width:none }
    .chip{ @apply inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2 py-0.5 text-xs; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
  <!-- Topbar -->
  <header class="fixed inset-x-0 top-0 z-40 bg-gradient-to-r from-brand-600 to-accent-500 text-white shadow-soft">
    <div class="mx-auto flex h-16 max-w-screen-2xl items-center justify-between px-4">
      <div class="flex items-center gap-3">
        <a href="ipress-sedes.html" class="inline-flex items-center gap-3">
          <div class="select-none text-lg font-semibold tracking-wide">NextIaCorp</div>
        </a>
        <!-- Breadcrumb contextual -->
        <div class="hidden items-center gap-2 rounded-lg bg-white/15 px-3 py-1.5 md:flex">
          <span class="font-semibold">IPRESS San Martín</span>
          <span class="hidden text-xs text-white/70 md:inline">›</span>
          <span class="hidden text-xs text-white/95 md:inline">Sede Miraflores</span>
        </div>
      </div>
      <nav class="flex items-center gap-2">
        <a href="#" class="hidden rounded-lg bg-white/10 px-3 py-1.5 text-sm font-medium backdrop-blur hover:bg-white/20 md:inline">Soporte</a>
        <img src="https://api.dicebear.com/7.x/initials/svg?seed=ND" alt="avatar" class="h-8 w-8 rounded-full ring-2 ring-white/30"/>
      </nav>
    </div>
  </header>

  <!-- NAV NIVEL 2 (Sede) -->
  <nav class="fixed top-16 inset-x-0 z-30 bg-white border-b border-slate-200 shadow-soft" aria-label="Navegación de Sede">
    <div class="mx-auto max-w-screen-2xl px-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center overflow-x-auto py-2 gap-2 scrollbar-hide">
          <a href="sede-dashboard.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2 0v10a1 1 0 01-1 1h-3m-6 0h6"/></svg>
            <span>Dashboard</span>
          </a>
          <a href="sede-consultorios.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
            <span>Consultorios</span>
          </a>
          <a href="sede-usuarios.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
            <span>Usuarios</span>
          </a>
          <a href="sede-medicos.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M4 7a4 4 0 118 0 4 4 0 01-8 0zm12 4h4m-2-2v4m-6 4a6 6 0 10-12 0"/></svg>
            <span>Médicos</span>
          </a>
          <a href="sede-especialidades.html" aria-current="page" class="flex items-center gap-2 rounded-lg bg-brand-50 px-3 py-2 text-sm font-semibold text-brand-700 border-b-2 border-brand-600 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 6a3 3 0 10-6 0v5a3 3 0 106 0V9m0 2a4 4 0 104 4h1a3 3 0 003-3V6"/></svg>
            <span>Especialidades</span>
          </a>
          <a href="sede-servicios.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 7l9-4 9 4-9 4-9-4m0 5l9 4 9-4m-18 5l9 4 9-4"/></svg>
            <span>Servicios</span>
          </a>
          <a href="sede-horarios.html" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-brand-600"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6l4 2m6-2a10 10 0 11-20 0 10 10 0 0120 0z"/></svg>
            <span>Horarios</span>
          </a>
        </div>
        <div class="flex items-center gap-2">
          <a href="sede-especialidades.html" class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 hover:bg-slate-50">← Volver a la bandeja</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="pt-36 pb-24">
    <div class="mx-auto max-w-screen-2xl px-6">
      <!-- Breadcrumbs -->
      <nav class="text-xs text-slate-500">
        <a class="hover:underline" href="ipress.html">IPRESS</a> /
        <a class="hover:underline" href="sede-dashboard.html">Sede Miraflores</a> /
        <a class="hover:underline" href="sede-especialidades.html">Especialidades</a> /
        <span class="text-slate-700 font-medium">Registrar Especialidades</span>
      </nav>

      <!-- Header -->
      <div class="mt-1 mb-6 flex flex-wrap items-center justify-between gap-3">
        <div>
          <h1 class="text-2xl font-semibold tracking-tight text-slate-800">Registrar / Editar Especialidad de la Sede</h1>
          <p class="text-sm text-slate-500">Vincula una <span class="font-medium">especialidad</span> al catálogo de la sede y configura sus reglas de operación.</p>
        </div>
        <div class="flex items-center gap-2">
          <a href="sede-especialidades.html" class="rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50">← Volver a la bandeja</a>
        </div>
      </div>

      <!-- Formulario -->
      <form id="formSedeEsp" class="grid gap-6 lg:grid-cols-3">
        <!-- Columna izquierda -->
        <section class="lg:col-span-2 space-y-6">
          <!-- 1. Datos base -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h2 class="mb-4 text-lg font-semibold">Datos de la especialidad</h2>
            <div class="grid gap-4 md:grid-cols-3">
              <div class="md:col-span-2">
                <label class="mb-1 block text-sm font-medium text-slate-700">Especialidad <span class="text-rose-600">*</span></label>
                <input list="dl_especialidad" name="especialidad" required placeholder="Empieza a escribir: Cardiología, Dermatología…" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
                <datalist id="dl_especialidad">
                  <option value="Cardiología"></option>
                  <option value="Dermatología"></option>
                  <option value="Pediatría"></option>
                  <option value="Ginecología"></option>
                  <option value="Medicina Interna"></option>
                </datalist>
                <p class="mt-1 text-xs text-slate-400">Fuente: tabla <code>especialidad</code>.</p>
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Estado</label>
                <select name="estado_id" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option value="1" selected>Activa</option>
                  <option value="2">Inactiva</option>
                </select>
                <p class="mt-1 text-xs text-slate-400">Catálogo: <code>catalogo_estado</code>.</p>
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Código interno (sede)</label>
                <input name="codigo_interno" type="text" placeholder="Ej. ESP-CL-001" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Etiqueta / Color</label>
                <div class="flex items-center gap-2">
                  <input name="etiqueta" type="text" placeholder="Cardiología" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
                  <input name="color" type="color" value="#4f46e5" class="h-10 w-12 rounded-xl border border-slate-200" />
                </div>
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Icono</label>
                <select name="icono" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option value="stethoscope">Estetoscopio</option>
                  <option value="heart">Corazón</option>
                  <option value="eye">Oftalmo</option>
                </select>
              </div>
              <div class="md:col-span-3 grid gap-3 md:grid-cols-3">
                <label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" name="visible_reserva" class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-600"> Visible en reservas</label>
                <label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" name="publica_web" class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-600"> Publicar en web</label>
                <label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" name="telemedicina" class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-600"> Habilitar telemedicina</label>
              </div>
            </div>
          </div>

          <!-- 2. Parámetros de reserva (override por sede) -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h2 class="mb-4 text-lg font-semibold">Parámetros de reserva</h2>
            <div class="grid gap-4 md:grid-cols-4">
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Modalidades</label>
                <select name="modalidades" multiple class="min-h-[110px] w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option value="PRESENCIAL" selected>PRESENCIAL</option>
                  <option value="VIRTUAL">VIRTUAL</option>
                  <option value="DOMICILIARIA">DOMICILIARIA</option>
                </select>
                <p class="mt-1 text-xs text-slate-400">Por defecto: <code>servicio_clinico.modalidades_permitidas</code></p>
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Duración por defecto</label>
                <div class="flex items-center gap-2"><input name="duracion" type="number" min="5" step="5" value="30" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" /><span class="text-sm text-slate-500">min</span></div>
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Cupo diario (tope)</label>
                <input name="cupo_diario" type="number" min="0" step="1" value="0" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Cancelación máx.</label>
                <div class="flex items-center gap-2"><input name="canc_horas" type="number" min="0" step="1" value="4" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" /><span class="text-sm text-slate-500">horas</span></div>
              </div>
              <div class="md:col-span-2 grid gap-3 md:grid-cols-2">
                <label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" name="requiere_orden" class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-600"> Requiere orden médica</label>
                <label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" name="requiere_autorizacion" class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-600"> Requiere autorización seguro</label>
                <label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" name="requiere_prepago" class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-600"> Requiere prepago</label>
                <label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" name="habilitar_toma_turno" class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-600"> Toma de turno en sede</label>
              </div>
            </div>
          </div>

          <!-- 3. Vinculaciones (médicos, servicios, consultorios) -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h2 class="mb-4 text-lg font-semibold">Vinculaciones</h2>
            <div class="grid gap-4 md:grid-cols-3">
              <div class="md:col-span-1">
                <label class="mb-1 block text-sm font-medium text-slate-700">Médicos (por especialidad)</label>
                <select name="medicos" multiple class="min-h-[160px] w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option>Dr. Pérez (CMP 12345)</option>
                  <option>Dra. Rivera (CMP 67890)</option>
                  <option>Dr. Gómez (CMP 11111)</option>
                </select>
                <p class="mt-1 text-xs text-slate-400">Fuente: <code>medico_especialidad</code> filtrando por especialidad.</p>
              </div>
              <div class="md:col-span-1">
                <label class="mb-1 block text-sm font-medium text-slate-700">Servicios vinculados</label>
                <select name="servicios" multiple class="min-h-[160px] w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option>Consulta Cardiología</option>
                  <option>Electrocardiograma</option>
                  <option>Ecocardiografía</option>
                </select>
                <p class="mt-1 text-xs text-slate-400">Fuente: <code>sede_servicio</code> / <code>servicio_clinico</code>.</p>
              </div>
              <div class="md:col-span-1">
                <label class="mb-1 block text-sm font-medium text-slate-700">Consultorios preferentes</label>
                <select name="consultorios" multiple class="min-h-[160px] w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option>Consultorio 101</option>
                  <option>Consultorio 203</option>
                  <option>Box 5 Emergencias</option>
                </select>
                <p class="mt-1 text-xs text-slate-400">Fuente: <code>consultorio</code>.</p>
              </div>
            </div>
          </div>

          <!-- 4. Reglas y criterios de atención -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h2 class="mb-4 text-lg font-semibold">Criterios de atención</h2>
            <div class="grid gap-4 md:grid-cols-4">
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Edad mínima</label>
                <input name="edad_min" type="number" min="0" step="1" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Edad máxima</label>
                <input name="edad_max" type="number" min="0" step="1" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Sexo permitido</label>
                <select name="sexo" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option value="NA" selected>NA</option>
                  <option value="F">Femenino</option>
                  <option value="M">Masculino</option>
                </select>
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">SLA de espera (min)</label>
                <input name="sla_espera" type="number" min="0" step="1" value="20" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div class="md:col-span-2">
                <label class="mb-1 block text-sm font-medium text-slate-700">Aseguradoras habilitadas</label>
                <select name="aseguradoras" multiple class="min-h-[100px] w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus:border-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-600/20">
                  <option>RIMAC</option>
                  <option>MAPFRE</option>
                  <option>Pacífico</option>
                  <option>La Positiva</option>
                </select>
              </div>
              <div class="md:col-span-2">
                <label class="mb-1 block text-sm font-medium text-slate-700">Notas</label>
                <textarea name="notas" rows="3" placeholder="Requisitos, restricciones o mensajes internos" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20"></textarea>
              </div>
            </div>
          </div>

          <!-- 5. Horarios base por especialidad (plantilla) -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold">Horarios base (plantilla de sede)</h2>
              <button type="button" id="btnAddSlot" class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm hover:bg-slate-50">+ Añadir franja</button>
            </div>
            <div id="slots" class="space-y-3">
              <div class="grid items-end gap-3 md:grid-cols-6">
                <div>
                  <label class="mb-1 block text-xs font-medium text-slate-600">Día</label>
                  <select class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-600 focus:outline-none">
                    <option>Lunes</option><option>Martes</option><option>Miércoles</option><option>Jueves</option><option>Viernes</option><option>Sábado</option><option>Domingo</option>
                  </select>
                </div>
                <div>
                  <label class="mb-1 block text-xs font-medium text-slate-600">Inicio</label>
                  <input type="time" value="08:00" class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-600 focus:outline-none"/>
                </div>
                <div>
                  <label class="mb-1 block text-xs font-medium text-slate-600">Fin</label>
                  <input type="time" value="13:00" class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-600 focus:outline-none"/>
                </div>
                <div>
                  <label class="mb-1 block text-xs font-medium text-slate-600">Duración (min)</label>
                  <input type="number" value="30" min="5" step="5" class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-600 focus:outline-none"/>
                </div>
                <div>
                  <label class="mb-1 block text-xs font-medium text-slate-600">Cupo/Hora</label>
                  <input type="number" value="2" min="0" step="1" class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-brand-600 focus:outline-none"/>
                </div>
                <div class="flex items-center gap-2">
                  <button type="button" class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50">Duplicar</button>
                  <button type="button" class="rounded-lg bg-rose-600 px-3 py-2 text-sm font-medium text-white hover:bg-rose-700">Eliminar</button>
                </div>
              </div>
            </div>
            <p class="mt-2 text-xs text-slate-400">Plantilla para generar <code>agenda_medico</code> por especialidad/sede.</p>
          </div>

          <!-- 6. Metadatos (backend) -->
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h2 class="mb-4 text-lg font-semibold">Metadatos</h2>
            <div class="grid gap-4 md:grid-cols-4">
              <div class="md:col-span-2">
                <label class="mb-1 block text-sm font-medium text-slate-700">Usuario registra</label>
                <input name="creado_por" type="text" placeholder="usuario@nextia" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Fecha registro</label>
                <input name="creado_en" type="datetime-local" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
              <div>
                <label class="mb-1 block text-sm font-medium text-slate-700">Últ. actualización</label>
                <input name="actualizado_en" type="datetime-local" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-brand-600 focus:ring-4 focus:ring-brand-600/20" />
              </div>
            </div>
            <p class="mt-2 text-xs text-slate-400">Campos autocompletables por backend.</p>
          </div>
        </section>

        <!-- Columna derecha -->
        <aside class="space-y-6">
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h3 class="mb-3 text-sm font-semibold text-slate-800">Acciones</h3>
            <div class="grid gap-2">
              <button type="submit" class="w-full rounded-lg bg-brand-600 px-4 py-2 text-sm font-semibold text-white hover:bg-brand-700">Guardar</button>
              <button type="button" id="btnGuardarNuevo" class="w-full rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50">Guardar y nuevo</button>
              <a href="sede-especialidades.html" class="w-full rounded-lg border border-slate-200 bg-white px-4 py-2 text-center text-sm font-medium text-slate-700 hover:bg-slate-50">Cancelar</a>
            </div>
          </div>
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h3 class="mb-2 text-sm font-semibold text-slate-800">Resumen</h3>
            <ul class="space-y-2 text-sm text-slate-600">
              <li>• Sede: <span class="font-medium">Miraflores</span></li>
              <li>• Especialidad: <span class="font-medium" id="sumEsp">—</span></li>
              <li>• Estado: <span class="font-medium" id="sumEstado">Activa</span> • Modalidades: <span class="font-medium" id="sumMods">PRESENCIAL</span></li>
              <li>• Médicos vinculados: <span class="font-medium" id="sumMed">0</span> • Servicios: <span class="font-medium" id="sumSrv">0</span></li>
            </ul>
            <p class="mt-2 text-xs text-slate-500">Tras guardar podrás asignar agendas en <em>Agenda</em>.</p>
          </div>
          <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
            <h3 class="mb-2 text-sm font-semibold text-slate-800">Ayuda</h3>
            <p class="text-xs text-slate-500">Este formulario creará/actualizará el vínculo <strong>Especialidad ↔ Sede</strong>. Si aún no existe una tabla pivote, sugerimos <code>sede_especialidad</code> con campos: <code>id, sede_id, especialidad_id, estado_id, visible_reserva, publica_web, telemedicina, modalidades, duracion, cupo_diario, canc_horas, requiere_orden, requiere_autorizacion, requiere_prepago, creado_*, actualizado_*</code>.</p>
          </div>
        </aside>
      </form>

      <!-- Notas técnicas de integración -->
      <details class="mt-8 rounded-xl border border-dashed border-slate-300 bg-slate-50/40 p-4 text-[13px] text-slate-600 open:shadow-soft">
        <summary class="cursor-pointer font-semibold">Notas técnicas (joins sugeridos)</summary>
        <ul class="mt-2 list-disc pl-5 space-y-1">
          <li>Catálogo de especialidades: <code>especialidad</code>.</li>
          <li>Vínculo sede-especialidad (propuesta): <code>sede_especialidad</code>.</li>
          <li>Médicos por especialidad: <code>medico_especialidad</code> → filtrar por <code>especialidad_id</code>. La pertenencia a sede puede derivarse de <code>agenda_medico.sede_id</code>.</li>
          <li>Servicios: <code>sede_servicio</code> ↔ <code>servicio_clinico</code> y su tarifa en <code>tarifa_servicio_sede</code>.</li>
          <li>Disponibilidad/plantilla: usar datos aquí para generar filas en <code>agenda_medico</code> (por especialidad).</li>
          <li>Reservas y atención: <code>reserva</code> y <code>consulta_medica</code> ya referencian <code>especialidad_id</code> + <code>sede_id</code>.</li>
        </ul>
      </details>
    </div>
  </main>

  <!-- Footer -->
  <footer class="fixed bottom-0 inset-x-0 z-40 border-t border-slate-200 bg-white/90 backdrop-blur">
    <div class="mx-auto flex h-12 max-w-screen-2xl items-center justify-between px-6 text-sm text-slate-600">
      <p>© <span id="y"></span> NextIaCorp • Sede Miraflores</p>
      <nav class="hidden gap-4 md:flex">
        <a class="hover:text-slate-900" href="#">Privacidad</a>
        <a class="hover:text-slate-900" href="#">Términos</a>
        <a class="hover:text-slate-900" href="#">Contacto</a>
      </nav>
    </div>
  </footer>

  <!-- Modal demo guardado -->
  <div id="saveModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-900/30 p-4">
    <div class="w-full max-w-sm rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
      <h3 class="text-base font-semibold text-slate-800">Especialidad de sede guardada</h3>
      <p class="mt-1 text-sm text-slate-600">Se creó/actualizó el registro correctamente.</p>
      <div class="mt-4 flex justify-end gap-2">
        <a href="sede-especialidades.html" class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm hover:bg-slate-50">Ir a la bandeja</a>
        <button data-close class="rounded-lg bg-brand-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-brand-700">Seguir editando</button>
      </div>
    </div>
  </div>

  <script>
    // Año
    document.getElementById('y').textContent = new Date().getFullYear();

    const form = document.getElementById('formSedeEsp');
    const sumEsp = document.getElementById('sumEsp');
    const sumEstado = document.getElementById('sumEstado');
    const sumMods = document.getElementById('sumMods');
    const sumMed = document.getElementById('sumMed');
    const sumSrv = document.getElementById('sumSrv');

    function getMulti(sel){
      return Array.from(sel.options).filter(o=>o.selected).map(o=>o.value);
    }

    function syncSummary(){
      const d = new FormData(form);
      sumEsp.textContent = d.get('especialidad') || '—';
      const estSel = form.querySelector('select[name="estado_id"]');
      sumEstado.textContent = estSel.options[estSel.selectedIndex]?.text || '—';
      const mods = getMulti(form.querySelector('select[name="modalidades"]'));
      sumMods.textContent = mods.length? mods.join(', ') : '—';
      sumMed.textContent = getMulti(form.querySelector('select[name="medicos"]')).length;
      sumSrv.textContent = getMulti(form.querySelector('select[name="servicios"]')).length;
    }

    form.addEventListener('input', syncSummary);
    form.addEventListener('change', syncSummary);
    syncSummary();

    // Guardar (demo)
    form.addEventListener('submit', function(e){
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target).entries());
      if(!data.especialidad){ alert('Selecciona una especialidad.'); return; }
      const modal = document.getElementById('saveModal');
      modal.classList.remove('hidden'); modal.classList.add('flex');
      modal.querySelector('[data-close]').onclick = () => { modal.classList.add('hidden'); modal.classList.remove('flex'); };
    });
    document.getElementById('btnGuardarNuevo').addEventListener('click', () => {
      if(!form.especialidad.value){ alert('Selecciona una especialidad.'); return; }
      alert('Especialidad guardada (demo). Se abre un nuevo formulario.');
      form.reset(); syncSummary();
    });

    // Añadir nuevas franjas de horario
    document.getElementById('btnAddSlot').addEventListener('click', () => {
      const cont = document.getElementById('slots');
      const tpl = cont.firstElementChild.cloneNode(true);
      cont.appendChild(tpl);
    });
  </script>
</body>
</html>
